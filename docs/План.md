Ниже — расчленённый на 10 этапов план, где **колонка “Файлы” содержит *полный* перечень классов/файлов, которые нужно добавить именно на этом этапе**.
Файлы перечислены в том порядке (и с тем путём), который показан в дереве архитектуры. Если элемент уже создан на предыдущем этапе, он не повторяется.

| №      | Этап                                                      | **Файлы, создаваемые на этапе**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------ | --------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1**  | **Скелет решения**                                        | `BuddyBot.sln`<br>`src/BuddyBot.Api/BuddyBot.Api.csproj`<br>`src/BuddyBot.Domain/BuddyBot.Domain.csproj`<br>`src/BuddyBot.Application/BuddyBot.Application.csproj`<br>`src/BuddyBot.Infrastructure/BuddyBot.Infrastructure.csproj`<br>`src/BuddyBot.Shared/BuddyBot.Shared.csproj`<br><br>`src/BuddyBot.Api/Program.cs`<br>`src/BuddyBot.Api/Startup.cs`<br>`src/BuddyBot.Api/appsettings.json`<br>`src/BuddyBot.Api/appsettings.Development.json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **2**  | **Shared-библиотека (утилиты и константы)**               | `BuddyBot.Shared/Constants/Roles.cs`<br>`BuddyBot.Shared/Constants/NotificationTypes.cs`<br>`BuddyBot.Shared/Constants/ComponentTypes.cs`<br>`BuddyBot.Shared/Constants/CacheKeys.cs`<br><br>`BuddyBot.Shared/Extensions/StringExtensions.cs`<br>`BuddyBot.Shared/Extensions/DateTimeExtensions.cs`<br>`BuddyBot.Shared/Extensions/EnumExtensions.cs`<br>`BuddyBot.Shared/Extensions/ServiceCollectionExtensions.cs`<br><br>`BuddyBot.Shared/Helpers/JsonHelper.cs`<br>`BuddyBot.Shared/Helpers/PasswordHelper.cs`<br>`BuddyBot.Shared/Helpers/ValidationHelper.cs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **3**  | **Domain Core (Users + Flows)**                           | `BuddyBot.Domain/Entities/Users/User.cs`<br>`BuddyBot.Domain/Entities/Users/Role.cs`<br>`BuddyBot.Domain/Entities/Flows/Flow.cs`<br>`BuddyBot.Domain/Entities/Flows/FlowStep.cs`<br>`BuddyBot.Domain/Entities/Flows/FlowStepComponent.cs`<br>`BuddyBot.Domain/Entities/Flows/FlowSettings.cs`<br>`BuddyBot.Domain/Entities/Flows/FlowAssignment.cs`<br><br>`BuddyBot.Domain/ValueObjects/TelegramUserId.cs`<br><br>`BuddyBot.Domain/Enums/AssignmentStatus.cs`<br>`BuddyBot.Domain/Enums/FlowStatus.cs`<br>`BuddyBot.Domain/Enums/StepStatus.cs`<br>`BuddyBot.Domain/Enums/ComponentStatus.cs`<br><br>`BuddyBot.Domain/Exceptions/DomainException.cs`<br>`BuddyBot.Domain/Exceptions/UserNotFoundException.cs`<br>`BuddyBot.Domain/Exceptions/FlowNotFoundException.cs`<br>`BuddyBot.Domain/Exceptions/FlowAlreadyAssignedException.cs`<br><br>`BuddyBot.Domain/Interfaces/Repositories/IUserRepository.cs`<br>`BuddyBot.Domain/Interfaces/Repositories/IFlowRepository.cs`<br>`BuddyBot.Domain/Interfaces/Repositories/IFlowAssignmentRepository.cs`<br>`BuddyBot.Domain/Interfaces/IUnitOfWork.cs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **4**  | **Domain Plus (Snapshots, Components, Progress, Events)** | **Snapshots**<br>`Entities/Snapshots/FlowSnapshot.cs`<br>`Entities/Snapshots/FlowStepSnapshot.cs`<br>`Entities/Snapshots/ComponentSnapshot.cs`<br><br>**Progress**<br>`Entities/Progress/FlowProgress.cs`<br>`Entities/Progress/StepProgress.cs`<br>`Entities/Progress/ComponentProgress.cs`<br>`Entities/Progress/UserProgress.cs`<br><br>**Components / Base**<br>`Entities/Components/Base/ComponentBase.cs`<br>`Entities/Components/Base/ComponentSnapshotBase.cs`<br><br>**Components / Article**<br>`ArticleComponent.cs` - `ArticleSnapshot.cs` - `ArticleProgressData.cs`<br>**Components / Task**<br>`TaskComponent.cs` - `TaskSnapshot.cs` - `TaskProgressData.cs`<br>**Components / Quiz**<br>`QuizComponent.cs` - `QuizSnapshot.cs` - `QuizQuestion.cs` - `QuizOption.cs` - `QuizProgressData.cs`<br>**Components / Video**<br>`VideoComponent.cs` - `VideoSnapshot.cs` - `VideoProgressData.cs`<br><br>**Notifications**<br>`Entities/Notifications/Notification.cs`<br>`NotificationTemplate.cs`<br>`NotificationAction.cs`<br><br>**Achievements**<br>`Achievement.cs` - `AchievementCriteria.cs` - `AchievementContext.cs`<br><br>**System**<br>`SystemSettings.cs` - `Holiday.cs` - `WorkingHours.cs`<br><br>**ValueObjects**<br>`DeadlineCalculation.cs`<br>`ProgressPercentage.cs`<br>`ComponentProgressData.cs`<br><br>**Enums (доп.)**<br>`ComponentType.cs`<br>`NotificationType.cs`<br>`AchievementRarity.cs`<br>`DayOfWeek.cs`<br><br>**Events**<br>`FlowAssigned.cs`<br>`ComponentCompleted.cs`<br>`StepUnlocked.cs`<br>`FlowCompleted.cs`<br>`AchievementEarned.cs`<br>`DeadlineApproaching.cs`<br><br>**Domain Services**<br>`FlowSnapshotService.cs`<br>`ProgressCalculationService.cs`<br>`DeadlineCalculationService.cs`<br>`AchievementService.cs`<br>`ComponentInteractionService.cs`<br><br>**Service-интерфейсы**<br>`IFlowSnapshotService.cs`<br>`IProgressCalculationService.cs`<br>`IDeadlineCalculationService.cs`<br>`IAchievementService.cs`<br>`INotificationService.cs`<br>`ITelegramBotService.cs`<br>`IDomainEventDispatcher.cs` |
| **5**  | **Application Core (Commands + DTOs + Validators)**       | **FlowAssignment Commands**<br>`AssignFlowCommand.cs`<br>`AssignFlowCommandHandler.cs`<br>`PauseFlowCommand.cs`<br>`ResumeFlowCommand.cs`<br>`ExtendDeadlineCommand.cs`<br><br>**ComponentInteraction Commands**<br>`InteractWithComponentCommand.cs`<br>`InteractWithComponentHandler.cs`<br>`StartReadingCommand.cs`<br>`FinishReadingCommand.cs`<br>`SubmitTaskAnswerCommand.cs`<br>`SubmitQuizAnswerCommand.cs`<br><br>**FlowManagement Commands**<br>`CreateFlowCommand.cs`<br>`UpdateFlowCommand.cs`<br>`ActivateFlowCommand.cs`<br>`ArchiveFlowCommand.cs`<br><br>**UserManagement Commands**<br>`CreateUserCommand.cs`<br>`UpdateUserRolesCommand.cs`<br>`DeactivateUserCommand.cs`<br><br>**Notifications Commands**<br>`SendNotificationCommand.cs`<br>`MarkNotificationReadCommand.cs`<br>`ScheduleNotificationCommand.cs`<br><br>**DTOs (Users, Flows, Progress, Components, Notifications)** — весь перечень `*.Dto.cs`<br><br>**Validators**<br>`AssignFlowCommandValidator.cs`<br>`CreateFlowCommandValidator.cs`<br>`ComponentInteractionValidator.cs`<br>`UpdateUserCommandValidator.cs`<br><br>**Mappings**<br>`UserMappingProfile.cs`<br>`FlowMappingProfile.cs`<br>`ProgressMappingProfile.cs`<br>`ComponentMappingProfile.cs`<br>`NotificationMappingProfile.cs`<br><br>**Behaviors**<br>`LoggingBehavior.cs`<br>`ValidationBehavior.cs`<br>`AuthorizationBehavior.cs`<br>`CachingBehavior.cs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **6**  | **Application Plus (Queries, Events, Background Jobs)**   | **Queries / Users**<br>`GetUserByIdQuery.cs`<br>`GetUserFlowsQuery.cs`<br>`GetUserProgressQuery.cs`<br>`GetUserAchievementsQuery.cs`<br><br>**Queries / Flows**<br>`GetFlowByIdQuery.cs`<br>`GetFlowDetailsQuery.cs`<br>`GetAvailableFlowsQuery.cs`<br>`GetFlowStatsQuery.cs`<br><br>**Queries / Progress**<br>`GetProgressByAssignmentQuery.cs`<br>`GetBuddyDashboardQuery.cs`<br>`GetAdminAnalyticsQuery.cs`<br><br>**Queries / Notifications**<br>`GetUserNotificationsQuery.cs`<br>`GetUnreadCountQuery.cs`<br><br>**EventHandlers**<br>`FlowAssignedEventHandler.cs`<br>`ComponentCompletedEventHandler.cs`<br>`StepUnlockedEventHandler.cs`<br>`FlowCompletedEventHandler.cs`<br>`AchievementEarnedEventHandler.cs`<br>`DeadlineApproachingEventHandler.cs`<br><br>**BackgroundJobs**<br>`DailyReminderJob.cs`<br>`DeadlineCheckJob.cs`<br>`ProgressSyncJob.cs`<br>`AchievementProcessingJob.cs`<br><br>**Interfaces**<br>`ICurrentUserService.cs`<br>`ICacheService.cs`<br>`IFileStorageService.cs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **7**  | **Infrastructure Persistence**                            | `Persistence/ApplicationDbContext.cs`<br><br>**Configurations**<br>`UserConfiguration.cs`<br>`FlowConfiguration.cs`<br>`FlowAssignmentConfiguration.cs`<br>`ProgressConfiguration.cs`<br>`ComponentConfiguration.cs`<br>`NotificationConfiguration.cs`<br>`AchievementConfiguration.cs`<br>`SystemSettingsConfiguration.cs`<br><br>**Repositories**<br>`UserRepository.cs`<br>`FlowRepository.cs`<br>`FlowAssignmentRepository.cs`<br>`ProgressRepository.cs`<br>`NotificationRepository.cs`<br>`AchievementRepository.cs`<br>`UnitOfWork.cs`<br><br>**Interceptors**<br>`AuditInterceptor.cs`<br>`DomainEventInterceptor.cs`<br><br>**Migrations (первичные)**<br>`20240120000001_Initial.cs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **8**  | **Infrastructure Plus (интеграции, кэш, auth)**           | **Доп. Migrations**<br>`20240121000001_AddSnapshots.cs`<br>`20240122000001_AddProgress.cs`<br>`20240123000001_AddNotifications.cs`<br>`20240124000001_AddAchievements.cs`<br><br>**ExternalServices / TelegramBot**<br>`TelegramBotService.cs`<br>`TelegramMessageBuilder.cs`<br>`InlineKeyboardBuilder.cs`<br>`WebhookHandler.cs`<br><br>**ExternalServices / FileStorage**<br>`LocalFileStorageService.cs`<br>`S3FileStorageService.cs`<br><br>**ExternalServices / Email**<br>`SmtpEmailService.cs`<br>`SendGridEmailService.cs`<br><br>**ExternalServices / Cache**<br>`RedisCacheService.cs`<br>`InMemoryCacheService.cs`<br><br>**Infrastructure Services**<br>`CurrentUserService.cs`<br>`DateTimeService.cs`<br>`TemplateService.cs`<br>`BackgroundJobService.cs`<br><br>**MessageBroker**<br>`RedisMessageBroker.cs`<br>`RabbitMqMessageBroker.cs`<br><br>**Authentication**<br>`JwtTokenService.cs`<br>`TelegramAuthenticationHandler.cs`<br>`RoleAuthorizationHandler.cs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **9**  | **API слой (HTTP, GraphQL, SignalR)**                     | **Controllers**<br>`Controllers/HealthController.cs`<br>`Controllers/TelegramWebhookController.cs`<br><br>**GraphQL / Queries**<br>`UserQueries.cs`<br>`FlowQueries.cs`<br>`ProgressQueries.cs`<br>`NotificationQueries.cs`<br><br>**GraphQL / Mutations**<br>`FlowAssignmentMutations.cs`<br>`ComponentInteractionMutations.cs`<br>`FlowManagementMutations.cs`<br>`UserManagementMutations.cs`<br><br>**GraphQL / Subscriptions**<br>`ProgressSubscriptions.cs`<br>`NotificationSubscriptions.cs`<br>`BuddySubscriptions.cs`<br><br>**GraphQL / Types**<br>`UserType.cs`<br>`FlowType.cs`<br>`ComponentTypes.cs`<br>`ProgressTypes.cs`<br>`NotificationTypes.cs`<br><br>**GraphQL / Inputs**<br>`AssignFlowInput.cs`<br>`ComponentInteractionInput.cs`<br>`CreateFlowInput.cs`<br><br>**GraphQL / Payloads**<br>`AssignFlowPayload.cs`<br>`InteractionPayload.cs`<br>`BasePayload.cs`<br><br>**GraphQL / Scalars**<br>`DateTimeScalar.cs`<br>`JsonScalar.cs`<br><br>**GraphQL / Extensions**<br>`UserExtensions.cs`<br>`FlowExtensions.cs`<br>`ProgressExtensions.cs`<br><br>**GraphQL / ErrorFilters**<br>`GlobalErrorFilter.cs`<br>`ValidationErrorFilter.cs`<br><br>**GraphQL / Middleware (auth)**<br>`AuthenticationMiddleware.cs`<br>`RoleAuthorizationMiddleware.cs`<br><br>**SignalR Hubs**<br>`NotificationHub.cs`<br>`ProgressHub.cs`<br>`BuddyHub.cs`<br><br>**API Middleware (pipeline)**<br>`ExceptionHandlingMiddleware.cs`<br>`RequestLoggingMiddleware.cs`<br>`RateLimitingMiddleware.cs`<br><br>**API Configuration**<br>`GraphQLConfiguration.cs`<br>`DatabaseConfiguration.cs`<br>`AuthenticationConfiguration.cs`<br>`TelegramBotConfiguration.cs`<br>`RedisConfiguration.cs`                                                                                                                                                                                                                                                                                                                                                                          |
| **10** | **Тесты и вспомогательные проекты**                       | **tests/BuddyBot.Domain.Tests/**<br>`BuddyBot.Domain.Tests.csproj`<br>`Entities/` (папка)  `Services/`  `ValueObjects/`<br><br>**tests/BuddyBot.Application.Tests/**<br>`BuddyBot.Application.Tests.csproj`<br>`Commands/`  `Queries/`  `EventHandlers/`<br><br>**tests/BuddyBot.Infrastructure.Tests/**<br>`BuddyBot.Infrastructure.Tests.csproj`<br>`Repositories/`  `Services/`<br><br>**tests/BuddyBot.Api.Tests/**<br>`BuddyBot.Api.Tests.csproj`<br>`GraphQL/`  `Controllers/`  `Integration/`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              